<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Persons App</title>

  <style>
    body {
      font-family: Arial;
      margin: 40px;
    }
    input, button {
      margin: 5px;
      padding: 6px;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
    }
  </style>
</head>

<body>

  <h2>Register</h2>
  <input type="number" id="r_roll" placeholder="Roll No">
  <input type="text" id="r_name" placeholder="Student Name">
  <input type="number" id="r_s1" placeholder="Subject 1 Marks">
  <input type="number" id="r_s2" placeholder="Subject 2 Marks">
  <input type="number" id="r_s3" placeholder="Subject 3 Marks">
  <input type="password" id="r_pass" placeholder="Password">
  <button type="button" onclick="register()">Register</button>

  <h2>Login</h2>
  <input type="number" id="l_roll" placeholder="Roll No">
  <input type="password" id="l_pass" placeholder="Password">
  <button type="button" onclick="login()">Login</button>

  <h2>Get Persons</h2>
  <button type="button" onclick="getPersons()">Fetch Persons</button>

  <h3>Output</h3>
  <pre id="output"></pre>

<script>
let token = "";

// REGISTER
async function register() {
  const res = await fetch("http://localhost:3000/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      rollno: Number(document.getElementById("r_roll").value),
      studentName: document.getElementById("r_name").value,
      subjects: {
        subject1: Number(document.getElementById("r_s1").value),
        subject2: Number(document.getElementById("r_s2").value),
        subject3: Number(document.getElementById("r_s3").value)
      },
      password: document.getElementById("r_pass").value
    })
  });

  document.getElementById("output").textContent =
    JSON.stringify(await res.json(), null, 2);
}

// LOGIN
async function login() {
  const res = await fetch("http://localhost:3000/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      rollno: Number(document.getElementById("l_roll").value),
      password: document.getElementById("l_pass").value
    })
  });

  const data = await res.json();
  token = data.token || "";
  document.getElementById("output").textContent =
    JSON.stringify(data, null, 2);
}

// GET PERSONS
async function getPersons() {
  const res = await fetch("http://localhost:3000/persons", {
    headers: {
      "Authorization": "Bearer " + token
    }
  });

  document.getElementById("output").textContent =
    JSON.stringify(await res.json(), null, 2);
}
</script>

</body>
</html>
